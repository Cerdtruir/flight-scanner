<p style="color: green"><%= notice %></p>

<h1>Flights</h1>

<div id="flights">
<div>
  <%= form_with(method: "get") do %>
    <%= label_tag(:query, "Select Origin") %>
    <%= select_tag "origin", options_for_select(@origins, params[:origin]), :include_blank => true, :onchange => "this.form.submit()" %>
    <br>
    <br>
    <% if params[:origin].present? %>
      <%= label_tag(:query, "Select Destiniation") %>
      <%= select_tag "destination", options_for_select(@destinations, params[:destination]), :include_blank => true, :onchange => "this.form.submit()" %>  
    <% end %>
  <% end %>
  <br>
</div>
<% if params[:origin].present? && params[:destination].present? %>
  <%= month_calendar(attribute: :date, events: @flights) do |date, flights| %>
    <%= date %>
    <%  @flights.each do |flight| %>
      <% if flight.date == date %>
        <div>
          <%= flight.price %>
          <br>
          <%= link_to "#{flight.airline}", "https://www.#{flight.airline}.co.za/Flight/Search?interline=false&fromCityCode=#{params[:origin]}&toCityCode=#{params[:destination]}&departureDateString=#{flight.date}&adults=1&children=0&infants=0&roundTrip=false&allInclusive=&promocode=&isSpecialAssistanceRequired=false&fareTypes=&currency=ZAR&showMonthView=false&fareTypeCategory=", target: :_blank %>
        </div>
        <% end %>
      <% end %>
    <% end %>
  <% end %>
</div>
